The message passing interface (MPI) is a common programming model for distributed computing. Message race (intended or not) leads to non-determinism making test and debug in MPI programs very difficult. This paper addresses the NP--complete problem of deadlock detection in single-path MPI programs (e.g., programs with no branching). The solution uses progressively more precise analyses to generate and then prune a potential set of deadlocks: static matching to identify deadlock pattern instances; execution of the instances on an abstract machine to remove some that are non-feasible; and finally, if needed, validation of the instances to remove any remaining that are non-feasible. Novel is the abstract machine based on counting to effectively reject non-feasible instances without exhaustively enumerating all message races. This paper further defines two distinct deadlock patterns with their validation: circular message dependency and orphaned receives. The paper includes a proof of each pattern showing them to be sound and complete in the approach. The efficiency of the approach is demonstrated in a set of benchmarks by comparing performance with two other solutions. The comparison shows an order of magnitude reduction in time and the ability to scale to millions of possible send-receive matches in the messaging.
