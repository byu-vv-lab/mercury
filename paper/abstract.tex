The message passing interface (MPI) is a common programming model for distributed computing. Message race (intended or not) leads to non-determinism making test and debug in MPI programs very difficult. This paper addresses the NP--complete problem of deadlock detection in single-path MPI programs (e.g., programs with no branching). The solution uses progressively more precise analyses to generate and then prune a potential set of deadlocks: static matching to identify deadlock pattern instances; execution of the instances on an abstract machine to reject those that are provably non-feasible; and finally, if needed, validation of the instances to remove any remaining that are non-feasible. Novel in the work is the abstract machine based on counting to efficiently reject many non-feasible instances without exhaustively enumerating all message races.  The paper further defines two deadlock patterns: circular dependency and orphaned receive. The first pattern relies on simple rules for validation, while the second requires a higher cost SMT encoding. The paper proves the approach sound and complete for each pattern and compares the approach with two other deadlock tools on typical benchmarks. The comparison shows that the new approach scales in the presence of millions of possible send-receive matches and completes on benchmarks where the other tools time out. The experiments also show that the two deadlock patterns in the paper cover all the deadlock cases in benchmarks. 
